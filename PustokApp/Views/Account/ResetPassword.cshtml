@model PustokApp.ViewModels.ResetPasswordVm
@{
	ViewData["Title"] = "Şifrəni Sıfırla";
}

<div class="container">
	<div class="row justify-content-center">
		<div class="col-md-6">
			<div class="card shadow-lg border-0">
				<div class="card-header bg-danger text-white text-center">
					<h4><i class="fas fa-key me-2"></i>Yeni şifrə Təyin Et</h4>
				</div>
				<div class="card-body p-4">
					<div class="text-center mb-4">
						<p class="text-muted">Hesabınız üçün yeni şifrə təyin edin</p>
						<small class="text-info">Email: <strong>@Model.Email</strong></small>
					</div>

					<form method="post">
						<input type="hidden" asp-for="Email" />
						<input type="hidden" asp-for="Token" />
						
						<div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>
						
						<div class="mb-3">
							<label asp-for="NewPassword" class="form-label">
								<i class="fas fa-lock me-1"></i>Yeni Şifrə
							</label>
							<div class="input-group">
								<input asp-for="NewPassword" class="form-control form-control-lg" 
									   placeholder="Yeni şifrəni daxil edin..." id="newPassword" />
								<button class="btn btn-outline-secondary" type="button" id="togglePassword1">
									<i class="fas fa-eye" id="toggleIcon1"></i>
								</button>
							</div>
							<span asp-validation-for="NewPassword" class="text-danger"></span>
							<div class="form-text">
								<small>
									<i class="fas fa-info-circle me-1"></i>
									Şifrə ən azı 6 simvol, böyük və kiçik hərf, rəqəm və xüsusi simvol olmalıdır
								</small>
							</div>
						</div>

						<div class="mb-3">
							<label asp-for="ConfirmPassword" class="form-label">
								<i class="fas fa-lock me-1"></i>Şifrəni Təkrarla
							</label>
							<div class="input-group">
								<input asp-for="ConfirmPassword" class="form-control form-control-lg" 
									   placeholder="Şifrəni təkrar daxil edin..." id="confirmPassword" />
								<button class="btn btn-outline-secondary" type="button" id="togglePassword2">
									<i class="fas fa-eye" id="toggleIcon2"></i>
								</button>
							</div>
							<span asp-validation-for="ConfirmPassword" class="text-danger"></span>
						</div>

						<!-- Şifrə gücü göstəricisi -->
						<div class="mb-3">
							<div class="progress" style="height: 6px;">
								<div class="progress-bar" role="progressbar" id="passwordStrength"></div>
							</div>
							<small id="passwordStrengthText" class="text-muted"></small>
						</div>

						<div class="d-grid gap-2 mb-3">
							<button type="submit" class="btn btn-danger btn-lg">
								<i class="fas fa-save me-2"></i>Şifrəni Yenilə
							</button>
						</div>
					</form>

					<hr class="my-4">
					
					<div class="text-center">
						<p class="mb-2">Şifrənizi xatırladınız?</p>
						<a asp-action="Login" class="btn btn-outline-primary">
							<i class="fas fa-sign-in-alt me-1"></i>Daxil Ol
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

@section Scripts{
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.21.0/jquery.validate.min.js" integrity="sha512-KFHXdr2oObHKI9w4Hv1XPKc898mE4kgYx58oqsc/JqqdLMDI4YjOLzom+EMlW8HFUd0QfjfAvxSL6sEq/a42fQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/4.0.0/jquery.validate.unobtrusive.min.js" integrity="sha512-xq+Vm8jC94ynOikewaQXMEkJIOBp7iArs3IhFWSWdRT3Pq8wFz46p+ZDFAR7kHnSFf+zUv52B3prRYnbDRdgog==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	
	<script>
		document.getElementById('togglePassword1').addEventListener('click', function() {
			const password = document.getElementById('newPassword');
			const icon = document.getElementById('toggleIcon1');
			if (password.type === 'password') {
				password.type = 'text';
				icon.classList.remove('fa-eye');
				icon.classList.add('fa-eye-slash');
			} else {
				password.type = 'password';
				icon.classList.remove('fa-eye-slash');
				icon.classList.add('fa-eye');
			}
		});

		document.getElementById('togglePassword2').addEventListener('click', function() {
			const password = document.getElementById('confirmPassword');
			const icon = document.getElementById('toggleIcon2');
			if (password.type === 'password') {
				password.type = 'text';
				icon.classList.remove('fa-eye');
				icon.classList.add('fa-eye-slash');
			} else {
				password.type = 'password';
				icon.classList.remove('fa-eye-slash');
				icon.classList.add('fa-eye');
			}
		});

		document.getElementById('newPassword').addEventListener('input', function() {
			const password = this.value;
			const strengthBar = document.getElementById('passwordStrength');
			const strengthText = document.getElementById('passwordStrengthText');
			
			let strength = 0;
			let text = '';
			let color = '';

			if (password.length >= 6) strength++;
			if (/[a-z]/.test(password)) strength++;
			if (/[A-Z]/.test(password)) strength++;
			if (/[0-9]/.test(password)) strength++;
			if (/[^A-Za-z0-9]/.test(password)) strength++;

			switch(strength) {
				case 0:
				case 1:
					text = 'Çox zəif';
					color = 'danger';
					break;
				case 2:
					text = 'Zəif';
					color = 'warning';
					break;
				case 3:
					text = 'Orta';
					color = 'info';
					break;
				case 4:
					text = 'Güclü';
					color = 'success';
					break;
				case 5:
					text = 'Çox güclü';
					color = 'success';
					break;
			}

			strengthBar.style.width = (strength * 20) + '%';
			strengthBar.className = 'progress-bar bg-' + color;
			strengthText.textContent = text;
			strengthText.className = 'text-' + color;
		});
	</script>
}